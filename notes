blast: hacking notes

Get fonts from http://www.worldofspectrum.org/infoseekid.cgi?id=0022511

Layout of buffer:

000		maxy: short
001		maxx: short
002		cury: short
003		curx: short
004		in_mode: short: (0=RAW 1=CBREAK 2=NOCBREAK (line)) | (4=ECHO) | (8=DELAY)
005		in_tm: long: half-delay timeout, if in_mode&8; else ignored
007		in_buf_p: short: bits 2:0 are the write index for input_isv(), bits 6:4 are the read index for getch() and friends, bit 7 is current caps lock state
008		in_buf: array of 8 char (if in_mode&3==NOCBREAK, then in_buf[1:0] is a pointer; in_buf[3:2] is the buffer length).  The buffer is circular (if input_isv() wants to write, and the buffer's full, it should beep())
010		in_last_scan: short: the last scancode read
011		(unused)
012		font: void *
014		font_stand: void *: if NULL, then use generated underlining
016		font_fmt: short: low 4 bits are format of font, high 4 are format of standout font
017		attr: current attributes
018		ado: long: attrdata offset
020		chardata: array of maxy lines, each of which is an array of maxx 7-bit characters; the high bit is used to indicate "needs repaint"
ado<<3	attrdata: array laid out similarly to chardata.  The repaint bit is common to both data and attribute parts (ie. if one is changed, both are repainted).  Attributes are stored in attrset() form (SBPPPIII)

Key-handling state machine
buffer full: do nothing
buffer not full:
	no key: in_last_scan = 0
	scan&0xe7 == in_last_scan&0xe7: do nothing
	scan&0xe7 != in_last_scan&0xe7: add key to the buffer; in_last_scan=scan
